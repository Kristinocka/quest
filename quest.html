<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ankieta</title>
</head>
<body>
<form id="form">
    <h1>Pożądane kanały i narzędzi komunikacji</h1>
    <div class="quest-content question">
        <div class="checkbox-quest-content">
            <p>1. Proszę wskazać jakie kanały dla komunikacji w pracy z poniżej podanych Pan/Pani najczęściej używa*</p>
        </div>
        <div class="quest-answer">
            <input type="checkbox" id="uf" name="uf" value="uf">
            <label for="uf">Ustny formalny</label>
        </div>
        <div class="quest-answer">
            <input type="checkbox" id="unf" name="unf" value="unf">
            <label for="unf">ustny nieformalny</label>
        </div>
        <div class="quest-answer">
            <input type="checkbox" id="pf" name="pf" value="pf">
            <label for="pf">pisemny formalny</label>
        </div>
        <div class="quest-answer">
            <input type="checkbox" id="pnf" name="pnf" value="pnf">
            <label for="pnf">pisemny nieformalny</label>
        </div>
    </div>

    <div class="question">
        2. proszę wskazać, które z poniżej podanych narzędzi komunikacji używane są w miejscy pracy Pana/Pani?*
        <div class=" radio-quest-content">
            <p></p>
            <div class="quest-answer">
                <p>Tak</p>
            </div>
            <div class="quest-answer">
                <p>Nie</p>
            </div>
            <div class="quest-answer">
                <p>Chce uzywac</p>
            </div>
            <div class="quest-answer">
                <p>Chce wiedziec jak dziala</p>
            </div>
        </div>
        <div class="radio-quest-content quest-content">
            <p>rozmowa telefoniczna</p>
            <div class="quest-answer">
                <input type="radio" name="q2" value="yes">
            </div>
            <div class="quest-answer">
                <input type="radio" name="q2" value="no">
            </div>
            <div class="quest-answer">
                <input type="radio" name="q2" value="want">
            </div>
            <div class="quest-answer">
                <input type="radio" name="q2" value="how">
            </div>
        </div>
        <div class="radio-quest-content quest-content">
            <p>spotkania</p>
            <div class="quest-answer">
                <input type="radio" name="q3" value="yes">
            </div>
            <div class="quest-answer">
                <input type="radio" name="q3" value="no">
            </div>
            <div class="quest-answer">
                <input type="radio" name="q3" value="want">
            </div>
            <div class="quest-answer">
                <input type="radio" name="q3" value="how">
            </div>
        </div>
    </div>
    <input type="submit" value="Submit">
</form>
<script type="text/javascript">
    var all_questions = document.querySelectorAll(".quest-content");

    <!--todo-->
    var firstQuestion = '1. Proszę wskazać jakie kanały dla komunikacji w pracy z poniżej podanych Pan/Pani najczęściej używa*'

    var jsonObj =   {}

    function addToJson(element){
        question = element.getElementsByTagName('p')[0].innerHTML
        <!--console.log(question)-->

         checkedInput = element.getElementsByTagName('input')
         var answers = []
        for (var i=0;i<checkedInput.length;i++){
          if ( checkedInput[i].checked ) {
            answers = [...answers, checkedInput[i].value]
          }
        }

        jsonObj[question] = answers

    }
      document.getElementById('form').addEventListener('submit', function(evt){
        evt.preventDefault();
           all_questions.forEach(addToJson)
           <!--console.log(all_questions)-->
           var unanswered = Object.keys(jsonObj).reduce((prev, x)=>(jsonObj[x].length>(x===firstQuestion ? 1 : 0)) ? prev : [...prev, x], [])
           console.log(unanswered)
            if (unanswered.length>0){
            alert('Niewystarczająca liczba odpowiedzi dla:\n'+unanswered.map(x=>x.slice(0,2)).join('\n'))
            } else {
                var xhr = new XMLHttpRequest();
                xhr.open("POST", '/answers', true);
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.send(JSON.stringify(Object.keys(jsonObj).map(key => ({'q':key,'v':jsonObj[key]}))));
                prompt('THX')
            }
           console.log(jsonObj)
    })


</script>
</body>
</html>
